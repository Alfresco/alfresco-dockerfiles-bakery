FROM java_base

EXPOSE 8080

ARG ALFRESCO_AUDIT_STORAGE_GROUP_NAME
ARG ALFRESCO_AUDIT_STORAGE_GROUP_ID
ARG ALFRESCO_AUDIT_STORAGE_USER_NAME
ARG ALFRESCO_AUDIT_STORAGE_USER_ID

COPY alfresco-audit-storage-app*.jar /opt/app.jar
COPY --from=local alfresco-audit-storage-app*.jar /opt/app.jar

RUN groupadd -g ${ALFRESCO_AUDIT_STORAGE_GROUP_ID} ${ALFRESCO_AUDIT_STORAGE_GROUP_NAME} && \
    useradd -u ${ALFRESCO_AUDIT_STORAGE_USER_ID} -g ${ALFRESCO_AUDIT_STORAGE_GROUP_NAME} ${ALFRESCO_AUDIT_STORAGE_USER_NAME} && \
    chgrp ${ALFRESCO_AUDIT_STORAGE_GROUP_NAME} /opt/app.jar

USER ${ALFRESCO_AUDIT_STORAGE_USER_NAME}

ADD entrypoint.sh /entrypoint.sh

CMD ["/entrypoint.sh"]
